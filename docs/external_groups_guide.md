# 钉钉外部群创建指南

## 🎯 什么是外部群？

钉钉外部群是一种特殊的群组类型，允许：
- **跨企业协作**: 与合作伙伴、客户、供应商等外部人员交流
- **灵活成员管理**: 支持添加企业外部联系人
- **权限控制**: 可以设置不同的访问权限

## 🚀 创建外部群的方法

### 方法1: 使用CSV文件批量创建（推荐）

#### 1. 准备CSV文件
创建包含外部群信息的CSV文件，例如 `external_groups.csv`：

```csv
群名称,群描述,群主用户ID,群成员用户ID列表,群组类型
外部合作群,与合作伙伴的交流群,manager001,"manager001,partner001,partner002",外部群
客户服务群,客户服务支持群,manager002,"manager002,client001,client002",外部群
供应商沟通群,供应商沟通交流群,manager003,"manager003,supplier001",外部群
```

#### 2. 运行创建命令
```bash
# 创建外部群
./ti-dding create --file external_groups.csv

# 查看创建结果
./ti-dding list
```

### 方法2: 使用示例文件
```bash
# 使用预定义的外部群示例
./ti-dding create --file data/external_groups_example.csv
```

## 📋 CSV文件格式说明

### 必需字段
| 字段 | 说明 | 示例 |
|------|------|------|
| 群名称 | 群组的显示名称 | 外部合作群 |
| 群描述 | 群组的描述信息 | 与合作伙伴的交流群 |
| 群主用户ID | 群主的钉钉用户ID | manager001 |
| 群成员用户ID列表 | 初始成员列表，用逗号分隔 | "manager001,partner001,partner002" |

### 可选字段
| 字段 | 说明 | 可选值 | 默认值 |
|------|------|--------|--------|
| 群组类型 | 群组类型标识 | 外部群、external、内部群、internal | 内部群 |

### 群组类型说明
- **内部群**: 仅限企业内部成员
  - 填写值: `内部群`、`internal` 或留空
  - 特点: 成员必须是企业员工
  
- **外部群**: 可包含外部联系人
  - 填写值: `外部群`、`external`
  - 特点: 可以添加企业外部人员

## ⚠️ 重要注意事项

### 1. 权限要求
确保你的钉钉应用有以下权限：
- **群组管理权限**: 创建和管理群组
- **通讯录权限**: 读取企业员工信息
- **外部联系人权限**: 管理外部联系人（如果需要）

### 2. 成员ID要求
- **群主**: 必须是企业内部员工
- **内部成员**: 必须是企业员工，使用员工ID
- **外部成员**: 使用外部联系人的唯一标识

### 3. 群组限制
- 外部群有成员数量限制
- 某些功能可能受限
- 需要遵守钉钉使用规范

## 🔧 故障排除

### 常见问题

#### 1. "创建群组失败: 权限不足"
**原因**: 应用没有创建外部群的权限
**解决**: 在钉钉开放平台申请相应权限

#### 2. "查询企业员工不存在"
**原因**: 指定的用户ID不正确
**解决**: 使用员工查询工具获取正确的用户ID

#### 3. "外部联系人不存在"
**原因**: 外部联系人ID不正确
**解决**: 确认外部联系人的唯一标识

### 调试技巧

#### 1. 检查配置文件
```bash
# 验证钉钉应用配置
cat configs/config.yaml
```

#### 2. 测试API连接
```bash
# 测试访问令牌
./tools/employee_query -config configs/config.yaml
```

#### 3. 查看详细日志
```bash
# 创建群组时查看详细输出
./ti-dding create --file external_groups.csv --verbose
```

## 📊 外部群管理

### 查看群组信息
```bash
# 列出所有群组
./ti-dding list

# 导出群组信息到CSV
./ti-dding export --output external_groups_export.csv
```

### 成员管理
```bash
# 添加外部成员到指定群组
./ti-dding add-member --user-id "external001" --group-id "group123"

# 从群组移除成员
./ti-dding remove-member --user-id "external001" --group-id "group123"
```

## 💡 最佳实践

### 1. 群组命名规范
- 使用清晰的群组名称
- 包含群组用途信息
- 避免使用特殊字符

### 2. 成员管理
- 定期清理不活跃成员
- 控制群组规模
- 设置合适的权限

### 3. 内容管理
- 制定群组使用规范
- 定期清理无关内容
- 保护敏感信息

### 4. 监控和维护
- 定期检查群组状态
- 监控成员活动
- 及时处理问题

## 📚 相关资源

- [钉钉开放平台文档](https://open.dingtalk.com/document/)
- [群组管理API](https://open.dingtalk.com/document/orgapp/create-group)
- [外部联系人管理](https://open.dingtalk.com/document/orgapp/external-contact-management)

## 🔄 更新日志

- **v1.0.0**: 支持外部群创建
- **v1.1.0**: 增强群组类型支持
- **v1.2.0**: 优化外部群权限管理

---

**工具版本**: 1.0.0  
**最后更新**: 2024年1月  
**兼容性**: Go 1.20+ 